<ion-header [translucent]="true">
  <ion-toolbar>
    <app-toolbar-global [titulo]="'Carteira'" [mostrarBotaoVoltar]="true"></app-toolbar-global>
  </ion-toolbar>
</ion-header>

<ion-content class="no-scroll">
  <div class="linha-separadora-topo"></div>

  <!-- Spinner de carregamento -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Carregando informações...</p>
  </div>

  <!-- Conteúdo quando carregado -->
  <div *ngIf="!isLoading">
    <div class="saldo-container">
      <div class="saldo-total">
        <ion-label class="saldo-label">Saldo disponível</ion-label>
        <ion-label class="valor-saldo" [class.valor-zero]="saldoDisponivel === 0">
          {{ formatarValor(saldoDisponivel) }}
        </ion-label>
      </div>

      <div class="botoes-acao">
        <ion-button expand="block" fill="solid" color="primary" class="botao-acao" (click)="solicitarSaque()" [disabled]="saldoDisponivel <= 0">
          <ion-icon name="arrow-down-outline" slot="start"></ion-icon>
          Sacar
        </ion-button>

        <ion-button expand="block" fill="outline" color="primary" class="botao-acao" (click)="verTodasTransacoes()">
          <ion-icon name="cash-outline" slot="start"></ion-icon>
          Extrato
        </ion-button>
      </div>
    </div>

    <div class="card-cinza">
      <ion-item lines="none">
        <ion-label>
          <h2>Histórico recente</h2>
        </ion-label>
        <ion-button fill="clear" slot="end" color="medium" (click)="verTodasTransacoes()" [disabled]="ultimasTransacoes.length === 0">
          Ver tudo
          <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
        </ion-button>
      </ion-item>

      <!-- Transações dinâmicas -->
      <div *ngFor="let transacao of ultimasTransacoes" class="transacao-item">
        <ion-icon
          [name]="transacao.valor > 0 ? 'trash-outline' : 'arrow-down-circle-outline'"
          [color]="transacao.valor > 0 ? 'success' : 'danger'"
          class="icone-transacao">
        </ion-icon>
        <div class="detalhes-transacao">
          <ion-label class="descricao">{{ transacao.descricao || 'Coleta realizada' }}</ion-label>
          <ion-label class="data">{{ transacao.data | date:'dd/MM/yyyy - HH:mm' }}</ion-label>
        </div>
        <ion-label class="valor" [class.positivo]="transacao.valor > 0" [class.negativo]="transacao.valor < 0">
          {{ transacao.valor > 0 ? '+' : '' }}{{ formatarValor(transacao.valor) }}
        </ion-label>
      </div>

      <!-- Mensagem quando não há transações -->
      <div *ngIf="ultimasTransacoes.length === 0" class="nenhuma-transacao">
        <ion-icon name="receipt-outline" color="medium"></ion-icon>
        <ion-label>Nenhuma transação recente</ion-label>
      </div>
    </div>

    <div class="card-cinza">
      <ion-item lines="none">
        <ion-icon name="information-circle-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h2>Informações</h2>
          <p>Pagamentos são liberados 24h após a coleta confirmada</p>
        </ion-label>
      </ion-item>
    </div>

    <div class="card-cinza">
      <ion-item lines="none" routerLink="/metodos-pagamento">
        <ion-icon name="card-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h2>Métodos de pagamento</h2>
          <p>{{ metodoPagamentoPadrao || 'Nenhum método cadastrado' }}</p>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" color="medium"></ion-icon>
      </ion-item>
    </div>
  </div>
</ion-content>

<app-footer-global></app-footer-global>
